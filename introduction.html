<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introduction</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="chapters.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<header class="bg-dark text-white py-3">
    <div class="container">
        <h1 class="text-center">Introduction</h1>
        <nav class="nav justify-content-center">
            <a class="nav-link text-white" href="index.html">Home</a>
            <a class="nav-link text-white" href="volumes.html">Volumes</a>
            <a class="nav-link text-white" href="faq.html">FAQ</a>
            <a class="nav-link text-white" href="commissions.html">Commissions</a>
        </nav>
    </div>
</header>
<main class="container my-4">
    <div class="text-center mb-4">
        <h2>Chapter Title</h2>
        <p>Description or content of the chapter goes here.</p>
    </div>
    <div class="text-center mb-4 button-group">
        <div class="button-row">
            <button id="prevVolumeTopBtn" class="btn btn-secondary">Previous Volume</button>
            <button id="prevChapterTopBtn" class="btn btn-secondary">Previous Chapter</button>
            <button id="prevPageTopBtn" class="btn btn-secondary">Previous Page</button>
        </div>
        <div class="button-row">
            <select id="topChapterDropdown" class="custom-select" style="width: auto;"></select>
        </div>
        <div class="button-row">
            <select id="topPageDropdown" class="custom-select" style="width: auto;"></select>
        </div>
        <div class="button-row">
            <button id="nextPageTopBtn" class="btn btn-secondary">Next Page</button>
            <button id="nextChapterTopBtn" class="btn btn-secondary">Next Chapter</button>
            <button id="nextVolumeTopBtn" class="btn btn-secondary">Next Volume</button>
        </div>
    </div>
    <div class="comic-container text-center">
        <img id="comicImage" src="imagesintro/page1.png" alt="Comic Image" class="img-fluid">
    </div>
    <div class="text-center mb-4 button-group">
        <div class="button-row">
            <button id="prevVolumeBottomBtn" class="btn btn-secondary">Previous Volume</button>
            <button id="prevChapterBottomBtn" class="btn btn-secondary">Previous Chapter</button>
            <button id="prevPageBottomBtn" class="btn btn-secondary">Previous Page</button>
        </div>
        <div class="button-row">
            <select id="bottomPageDropdown" class="custom-select" style="width: auto;"></select>
        </div>
        <div class="button-row">
            <select id="bottomChapterDropdown" class="custom-select" style="width: auto;"></select>
        </div>
        <div class="button-row">
            <button id="nextPageBottomBtn" class="btn btn-secondary">Next Page</button>
            <button id="nextChapterBottomBtn" class="btn btn-secondary">Next Chapter</button>
            <button id="nextVolumeBottomBtn" class="btn btn-secondary">Next Volume</button>
        </div>
    </div>
    <div class="comments-section">
        <h3>Comments</h3>
        <form>
            <div class="form-group">
                <label for="commentText">Leave a comment:</label>
                <textarea class="form-control" id="commentText" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary" id="submitCommentBtn">Submit</button>
        </form>
        <div id="submittedComments"></div>
    </div>
</main>
<footer class="bg-dark text-white py-3">
    <div class="container text-center">
        <p>&copy; 2024 RFighter. All rights reserved.</p>
    </div>
</footer>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const chapterNames = ['Introduction', 'Prologue'];
    for (let i = 1; i <= 34; i++) {
        chapterNames.push(`Chapter ${i}`);
    }
    const totalVolumes = 12;
    const username = 'You';
    const currentChapter = getCurrentChapter();

    // Define volume structure
    const volumes = [
        ['Introduction', 'Prologue', 'Chapter 1'],
        ['Chapter 2', 'Chapter 3', 'Chapter 4'],
        ['Chapter 5', 'Chapter 6', 'Chapter 7'],
        ['Chapter 8', 'Chapter 9', 'Chapter 10'],
        ['Chapter 11', 'Chapter 12', 'Chapter 13'],
        ['Chapter 14', 'Chapter 15', 'Chapter 16'],
        ['Chapter 17', 'Chapter 18', 'Chapter 19'],
        ['Chapter 20', 'Chapter 21', 'Chapter 22'],
        ['Chapter 23', 'Chapter 24', 'Chapter 25'],
        ['Chapter 26', 'Chapter 27', 'Chapter 28'],
        ['Chapter 29', 'Chapter 30', 'Chapter 31'],
        ['Chapter 32', 'Chapter 33', 'Chapter 34']
    ];

    function getVolumeIndex(chapter) {
        return volumes.findIndex(volume => volume.includes(chapter));
    }

    function getCurrentChapter() {
        const url = window.location.pathname;
        if (url.includes('introduction.html')) return 'Introduction';
        if (url.includes('prologue.html')) return 'Prologue';
        const chapterMatch = url.match(/chapter(\d+)\.html/);
        return chapterMatch ? `Chapter ${chapterMatch[1]}` : null;
    }

    function navigateToChapter(chapter) {
        let url;
        if (chapter === 'Introduction') url = 'introduction.html';
        else if (chapter === 'Prologue') url = 'prologue.html';
        else {
            const chapterNumber = chapter.split(' ')[1];
            url = `chapter${chapterNumber}.html`;
        }
        window.location.href = url;
    }

    function navigateToVolume(direction) {
        const currentVolumeIndex = getVolumeIndex(currentChapter);
        let newVolumeIndex;
        if (direction === 'next') {
            newVolumeIndex = currentVolumeIndex + 1;
        } else {
            newVolumeIndex = currentVolumeIndex - 1;
        }
        if (newVolumeIndex >= 0 && newVolumeIndex < totalVolumes) {
            navigateToChapter(volumes[newVolumeIndex][0]);
        } else {
            alert('No more volumes available.');
        }
    }

    function navigateToChapterInVolume(direction) {
        const currentVolumeIndex = getVolumeIndex(currentChapter);
        const currentVolume = volumes[currentVolumeIndex];
        let newChapterIndex;
        if (direction === 'next') {
            newChapterIndex = currentVolume.indexOf(currentChapter) + 1;
        } else {
            newChapterIndex = currentVolume.indexOf(currentChapter) - 1;
        }
        if (newChapterIndex >= 0 && newChapterIndex < currentVolume.length) {
            navigateToChapter(currentVolume[newChapterIndex]);
        } else {
            alert('No more chapters available.');
        }
    }

    const topChapterDropdown = document.getElementById('topChapterDropdown');
    const bottomChapterDropdown = document.getElementById('bottomChapterDropdown');
    const topPageDropdown = document.getElementById('topPageDropdown');
    const bottomPageDropdown = document.getElementById('bottomPageDropdown');

    const populateDropdown = (dropdown, items) => {
        dropdown.innerHTML = ''; // Clear existing options
        items.forEach((item) => {
            const option = document.createElement('option');
            option.value = item;
            option.text = item;
            dropdown.appendChild(option);
        });
        dropdown.value = currentChapter;
    };

    const syncChapterDropdowns = (value) => {
        topChapterDropdown.value = value;
        bottomChapterDropdown.value = value;
    };

    const syncPageDropdowns = (value) => {
        topPageDropdown.value = value;
        bottomPageDropdown.value = value;
    };

    populateDropdown(topChapterDropdown, chapterNames);
    populateDropdown(bottomChapterDropdown, chapterNames);

    topChapterDropdown.addEventListener('change', (e) => {
        navigateToChapter(e.target.value);
    });

    bottomChapterDropdown.addEventListener('change', (e) => {
        navigateToChapter(e.target.value);
    });

    // Comic image handling
    const comicImage = document.getElementById('comicImage');

    async function fetchTotalComicPages() {
        return new Promise((resolve) => {
            setTimeout(() => {
                const totalPages = 100; // Maximum page limit
                resolve(totalPages);
            }, 100); // Simulate delay
        });
    }

    function extractPageNumber(pageName) {
        const match = pageName.match(/page(\d+)\.png$/);
        return match ? parseInt(match[1], 10) : NaN;
    }

    async function initializeComicPages() {
        const totalComicPages = await fetchTotalComicPages();
        const imageBasePath = 'imagesintro/';
        const imageExtension = '.png';
        const comicPages = [];
        const topDropdownOptions = [];
        const bottomDropdownOptions = [];
        const promises = [];

        for (let i = 1; i <= totalComicPages; i++) {
            const pageUrl = `${imageBasePath}page${i}${imageExtension}`;
            const img = new Image();
            const promise = new Promise((resolve) => {
                img.onload = () => {
                    comicPages.push(pageUrl);
                    const option = document.createElement('option');
                    option.value = pageUrl;
                    option.text = `Page ${i}`;
                    topDropdownOptions.push(option);
                    bottomDropdownOptions.push(option.cloneNode(true));
                    resolve();
                };
                img.onerror = () => resolve(); // Resolve even if image is not found
            });
            img.src = pageUrl;
            promises.push(promise);
        }

        await Promise.all(promises);

        // Sort the dropdown options by page number
        topDropdownOptions.sort((a, b) => {
            const numA = parseInt(a.text.replace('Page ', ''), 10);
            const numB = parseInt(b.text.replace('Page ', ''), 10);
            return numA - numB;
        });

        bottomDropdownOptions.sort((a, b) => {
            const numA = parseInt(a.text.replace('Page ', ''), 10);
            const numB = parseInt(b.text.replace('Page ', ''), 10);
            return numA - numB;
        });

        topPageDropdown.innerHTML = ''; // Clear existing options
        bottomPageDropdown.innerHTML = ''; // Clear existing options
        topPageDropdown.append(...topDropdownOptions);
        bottomPageDropdown.append(...bottomDropdownOptions);

        // Set the initial image and sync dropdowns
        if (comicPages.length > 0) {
            comicImage.src = comicPages[0];
            syncPageDropdowns(comicPages[0]);
        }

        topPageDropdown.addEventListener('change', (e) => {
            comicImage.src = e.target.value;
            syncPageDropdowns(e.target.value);
        });
        bottomPageDropdown.addEventListener('change', (e) => {
            comicImage.src = e.target.value;
            syncPageDropdowns(e.target.value);
        });
    }

    initializeComicPages();

    function navigatePage(direction) {
        const currentPageNumber = extractPageNumber(comicImage.src);
        const newPageNumber = direction === 'next' ? currentPageNumber + 1 : currentPageNumber - 1;
        const newPageUrl = `imagesintro/page${newPageNumber}.png`;
        const img = new Image();
        img.onload = () => {
            comicImage.src = newPageUrl;
            syncPageDropdowns(newPageUrl);
        };
        img.onerror = () => alert('No more pages available.');
        img.src = newPageUrl;
    }

    // Top navigation buttons
    document.getElementById('prevVolumeTopBtn').addEventListener('click', () => navigateToVolume('previous'));
    document.getElementById('nextVolumeTopBtn').addEventListener('click', () => navigateToVolume('next'));
    document.getElementById('prevChapterTopBtn').addEventListener('click', () => navigateToChapterInVolume('previous'));
    document.getElementById('nextChapterTopBtn').addEventListener('click', () => navigateToChapterInVolume('next'));
    document.getElementById('prevPageTopBtn').addEventListener('click', () => navigatePage('previous'));
    document.getElementById('nextPageTopBtn').addEventListener('click', () => navigatePage('next'));

    // Bottom navigation buttons
    document.getElementById('prevVolumeBottomBtn').addEventListener('click', () => navigateToVolume('previous'));
    document.getElementById('nextVolumeBottomBtn').addEventListener('click', () => navigateToVolume('next'));
    document.getElementById('prevChapterBottomBtn').addEventListener('click', () => navigateToChapterInVolume('previous'));
    document.getElementById('nextChapterBottomBtn').addEventListener('click', () => navigateToChapterInVolume('next'));
    document.getElementById('prevPageBottomBtn').addEventListener('click', () => navigatePage('previous'));
    document.getElementById('nextPageBottomBtn').addEventListener('click', () => navigatePage('next'));

    // Comments handling
    const commentText = document.getElementById('commentText');
    const submittedComments = document.getElementById('submittedComments');
    document.getElementById('submitCommentBtn').addEventListener('click', function(e) {
        e.preventDefault();
        const comment = commentText.value.trim();
        if (comment !== '') {
            const commentElement = document.createElement('div');
            commentElement.classList.add('comment');
            const date = new Date();
            const formattedDate = date.toLocaleString();
            commentElement.innerHTML = `<strong>${username}:</strong> ${comment}<br><small>${formattedDate}</small>`;
            submittedComments.prepend(commentElement);
            commentText.value = '';
        }
    });
});


</script>
</body>
</html>
